<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fest-Mate</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <style>
        :root {
            --bg-color: #FFF9F5;
            --primary-gradient: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%); 
            --btn-gradient: linear-gradient(90deg, #F687B3 0%, #F6AD55 100%);
            --text-dark: #2D3748;
            --text-gray: #718096;
            --input-border: #E2E8F0;
        }

        body {
            margin: 0; font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-dark);
            min-height: 100vh; display: flex; justify-content: center; align-items: center; overflow-x: hidden;
        }

        .hidden { display: none !important; }
        .container { width: 100%; max-width: 440px; padding: 24px; text-align: center; animation: fadeIn 0.4s ease-out; }
        
        /* Styles from your design */
        .icon-box { width: 80px; height: 80px; background: linear-gradient(135deg, #FF8FAB, #FFC2D1); border-radius: 24px; margin: 0 auto 24px; display: flex; justify-content: center; align-items: center; box-shadow: 0 15px 30px -10px rgba(255, 143, 171, 0.6); position: relative; }
        .icon-box svg { width: 40px; height: 40px; stroke: white; fill: none; stroke-width: 2.5; }
        h1 { font-family: 'Playfair Display', serif; font-size: 3rem; margin: 0 0 10px; background: linear-gradient(90deg, #E65C7B, #F98C6D); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }
        .subtitle { color: var(--text-gray); margin-bottom: 30px; }
        
        .form-card { background: white; padding: 30px; border-radius: 24px; box-shadow: 0 10px 40px -10px rgba(0,0,0,0.05); text-align: left; }
        .btn-primary { width: 100%; padding: 16px; border-radius: 18px; border: none; background: var(--btn-gradient); color: white; font-weight: 600; cursor: pointer; margin-top: 15px; }
        .btn-secondary { background: white; border: 1px solid #E2E8F0; color: #4A5568; width: 100%; padding: 16px; border-radius: 18px; margin-top: 15px; cursor: pointer; font-weight: 600; }
        
        input { width: 100%; padding: 14px; border: 1px solid var(--input-border); border-radius: 12px; margin-top: 5px; box-sizing: border-box; }
        
        /* Gender Buttons */
        .gender-options { display: flex; gap: 15px; margin-top: 5px; }
        .gender-btn { flex: 1; padding: 15px; border: 1px solid var(--input-border); border-radius: 16px; cursor: pointer; text-align: center; }
        .gender-btn.selected { border-color: #F687B3; background-color: #FFF5F7; color: #E65C7B; font-weight: 600; }

        /* Waitlist & ID Box */
        .waitlist-icon { width: 60px; height: 60px; background: #FFF5F5; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; }
        .id-box { background: #F7FAFC; padding: 15px; border-radius: 12px; margin: 20px 0; font-family: monospace; font-size: 1.5rem; font-weight: bold; letter-spacing: 2px; border: 1px dashed #CBD5E0; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .copy-btn { cursor: pointer; opacity: 0.6; width: 20px; }
        .queue-status { color: #E65C7B; font-weight: bold; font-size: 1.1rem; margin: 10px 0; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="landing-view" class="container">
        <div class="icon-box"><svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div>
        <h1>Fest-Mate</h1>
        <p class="subtitle">Matchmaking, simplified. Just vibes.</p>
        <button class="btn-primary" onclick="nav('form-view')">Get Started</button>
        <button class="btn-secondary" onclick="nav('check-view')">I Have a Match ID</button>
    </div>

    <div id="form-view" class="container hidden">
        <div class="form-card">
            <h2 style="margin-top:0;">Find your match</h2>
            
            <label>Mobile Number</label>
            <input type="tel" id="mobile" placeholder="9876543210">
            
            <label style="display:block; margin-top:15px;">Gender</label>
            <div class="gender-options">
                <div class="gender-btn" id="btn-male" onclick="selectGender('male')">üë® Male</div>
                <div class="gender-btn" id="btn-female" onclick="selectGender('female')">üë© Female</div>
            </div>

            <button class="btn-primary" onclick="payNow()">Find My Match (‚Çπ20)</button>
            <p style="text-align:center; color:#A0AEC0; cursor:pointer; margin-top:15px;" onclick="nav('landing-view')">Cancel</p>
        </div>
    </div>

    <div id="waitlist-view" class="container hidden">
        <h1 style="font-size: 2.5rem;">Fest-Mate</h1>
        
        <div class="waitlist-icon">
            <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#E65C7B" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
        </div>

        <h2 style="font-family: 'Playfair Display'; margin-bottom: 5px;">In the Waitlist</h2>
        <p style="color: #718096;">Waiting for your perfect match...</p>

        <div class="queue-status" id="display-position">Your position: #Calculating</div>
        <p style="font-size: 0.9rem; color: #718096;" id="display-wait-msg">Waiting for signups to match.</p>

        <div class="form-card" style="margin-top: 25px; text-align: center;">
            <p style="margin:0; color:#718096; font-size: 0.85rem;">Your Match ID</p>
            <div class="id-box">
                <span id="generated-id">...</span>
                <svg class="copy-btn" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" onclick="copyID()"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
            </div>
            <p style="font-size: 0.8rem; color: #A0AEC0;">Save this ID to check your status later</p>
        </div>
        
        <button class="btn-secondary" onclick="nav('landing-view')">Back to Home</button>
    </div>

    <div id="check-view" class="container hidden">
        <div class="form-card">
            <h2>Check Status</h2>
            <input type="text" id="check-id-input" placeholder="Enter Match ID" style="text-align:center; font-weight:bold; letter-spacing:1px;">
            <button class="btn-primary" onclick="checkStatus()">Check Status</button>
            
            <div id="status-result" class="hidden" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                <p id="status-text" style="font-weight: bold; color: #2D3748;">Loading...</p>
                <button id="whatsapp-btn" class="btn-primary hidden" style="background: #25D366;">
                    Connect on WhatsApp üí¨
                </button>
            </div>

            <p style="text-align:center; color:#A0AEC0; cursor:pointer; margin-top:15px;" onclick="nav('landing-view')">Back</p>
        </div>
    </div>

    <script>
        const RAZORPAY_KEY = "rzp_test_S3e2P3RW8rOeE0"; // Replace if needed
        let selectedGender = null;

        function nav(viewId) {
            document.querySelectorAll('.container').forEach(el => el.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
        }

        function selectGender(g) {
            selectedGender = g;
            document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('btn-'+g).classList.add('selected');
        }

        function payNow() {
            const mobile = document.getElementById('mobile').value;
            if(!mobile || !selectedGender) return alert("Please fill all details");

            // Dummy Payment for Demo
            var options = {
                "key": RAZORPAY_KEY, "amount": 2000, "currency": "INR", "name": "Fest-Mate",
                "handler": function (response){
                    processSignup(mobile, selectedGender);
                },
                "prefill": { "contact": mobile }
            };
            new Razorpay(options).open();
        }

        // --- THE QUEUE LOGIC ---
        function processSignup(mobile, gender) {
            // 1. Generate ID
            const matchID = Math.random().toString(16).slice(2, 8).toUpperCase(); // e.g., 4C5617
            
            // 2. Get Current Counters
            let maleCount = parseInt(localStorage.getItem('count_male') || 0);
            let femaleCount = parseInt(localStorage.getItem('count_female') || 0);

            // 3. Assign Queue Position
            // If I am Male #5, my queue position is 5. I need 5 females to exist to be matched.
            let myQueueNumber = 0;
            if(gender === 'male') {
                maleCount++;
                localStorage.setItem('count_male', maleCount);
                myQueueNumber = maleCount; 
            } else {
                femaleCount++;
                localStorage.setItem('count_female', femaleCount);
                myQueueNumber = femaleCount;
            }

            // 4. Save User Data
            const userData = {
                id: matchID, mobile: mobile, gender: gender,
                queueNum: myQueueNumber, // "I am the 5th male"
                date: new Date().toISOString()
            };
            localStorage.setItem('user_' + matchID, JSON.stringify(userData));

            // 5. Show Waitlist Screen
            showWaitlistScreen(userData, maleCount, femaleCount);
        }

        function showWaitlistScreen(user, totalMales, totalFemales) {
            nav('waitlist-view');
            document.getElementById('generated-id').innerText = user.id;

            // Calculate Position
            // If I am Male #5, and there are 3 Females total.
            // My position in line = 5 - 3 = 2. (I am waiting for 2 more females).
            
            let oppositeCount = (user.gender === 'male') ? totalFemales : totalMales;
            let position = user.queueNum - oppositeCount;

            if (position <= 0) {
                // MATCHED!
                document.getElementById('display-position').innerText = "Status: MATCHED! üéâ";
                document.getElementById('display-position').style.color = "#25D366";
                document.getElementById('display-wait-msg').innerText = "Go to 'Check Status' to get their number!";
            } else {
                // WAITING
                document.getElementById('display-position').innerText = "Your position: #" + position;
                let needed = (user.gender === 'male') ? "female" : "male";
                document.getElementById('display-wait-msg').innerText = `Waiting for ${position} ${needed} signups to match.`;
            }
        }

        function checkStatus() {
            const id = document.getElementById('check-id-input').value.trim().toUpperCase();
            const user = JSON.parse(localStorage.getItem('user_' + id));
            const resultBox = document.getElementById('status-result');
            const statusText = document.getElementById('status-text');
            const waBtn = document.getElementById('whatsapp-btn');

            resultBox.classList.remove('hidden');
            
            if(!user) {
                statusText.innerText = "‚ùå ID Not Found";
                waBtn.classList.add('hidden');
                return;
            }

            // Check Live Queue Status
            let totalMales = parseInt(localStorage.getItem('count_male') || 0);
            let totalFemales = parseInt(localStorage.getItem('count_female') || 0);
            let oppositeCount = (user.gender === 'male') ? totalFemales : totalMales;
            
            // Queue Calculation
            let position = user.queueNum - oppositeCount;

            if(position <= 0) {
                // MATCHED logic
                statusText.innerText = "‚úÖ You have a Match!";
                statusText.style.color = "#25D366";
                waBtn.classList.remove('hidden');
                
                // Simulate getting the matched number (In real app, fetch from DB)
                // Here we just use a placeholder since we don't have the other person's data stored easily
                let dummyNumber = "919999999999"; 
                waBtn.onclick = () => window.open(`https://wa.me/${dummyNumber}?text=Hi! We matched on Fest-Mate.`, '_blank');
            } else {
                // STILL WAITING
                let needed = (user.gender === 'male') ? "female" : "male";
                statusText.innerText = `‚è≥ Still Waiting... Position #${position}`;
                statusText.style.color = "#E65C7B";
                waBtn.classList.add('hidden');
            }
        }

        function copyID() {
            const id = document.getElementById('generated-id').innerText;
            navigator.clipboard.writeText(id);
            alert("ID Copied: " + id);
        }
    </script>
</body>
</html>